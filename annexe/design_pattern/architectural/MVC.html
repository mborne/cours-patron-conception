<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
  <title>design_pattern/architectural/MVC.md</title>

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css">
  <style>
    html, body {
      width: 95%;
      margin: auto;
      padding-bottom: 50px;
    }
  </style>
</head>

<body>
  <article class="markdown-body">
    <h1 id="mvc">MVC</h1><h2 id="problème">Problème</h2><p>En l&#39;absence d&#39;un cadre, une application qui se complexifie à tendance à se transformer en un plat de spaghetti. On se retrouve avec des composants qui font du rendu et des calculs.</p>
<h2 id="principe">Principe</h2><p>Pour plus de modularité et de clarté, on effectue une séparation claire entre :</p>
<ul>
<li>Des <strong>vues</strong> qui gèrent l&#39;affichage</li>
<li>Des <strong>modèles</strong> représentant les données</li>
<li>Des <strong>contrôleurs</strong> qui gèrent l&#39;appel aux traitements</li>
</ul>
<h2 id="variante-de-mvc-dédié-au-web">Variante de MVC dédié au WEB</h2><p>Les applications web ont des besoins spécifiques à l&#39;utilisation du protocole HTTP. Généralement, le fonctionnement est le suivant :</p>
<ul>
<li>Les <strong>contrôleurs</strong> sont porteurs d&#39;<strong>actions</strong> correspondant chacune à une page/fonctionnalité</li>
<li>Un composant (<code>Router</code>) dirige chaque requête vers une action particulière :<ul>
<li><code>/books</code> : Action afficher la liste des livres (<code>BookController.listAction</code>)</li>
<li><code>/books/{id}</code> : Action afficher le livre d&#39;identifiant &quot;id&quot; (<code>BookController.showBook</code>)</li>
</ul>
</li>
<li>L&#39;<strong>action</strong> récupère et <strong>contrôle les paramètres de la requête</strong>. A l&#39;aide des paramètres, elle effectue un <strong>traitement et renvoie un résultat</strong>.</li>
<li>Le résultat est renvoyé sous forme d&#39;une <strong>réponse</strong> au client avec plusieurs cas de figures :<ul>
<li>Le résultat est renvoyé directement au client (réponse texte, contenu d&#39;un fichier,...)</li>
<li>Le résultat est renvoyé au client sous une forme sérialisée (JSON, XML,...)</li>
<li>Le résultat est mis en forme au format HTML à l&#39;aide d&#39;une <strong>vue</strong> s&#39;appuyant sur un moteur de template.</li>
</ul>
</li>
</ul>
<h3 id="exemple-de-code">Exemple de code</h3><ul>
<li><code>BookController.php</code> : Exemple de controller</li>
</ul>
<pre><code class="language-php">class BookController extends Controller {
    
    /*
     * @Route(&quot;/books&quot;,name=&quot;book_index&quot;)
     */
    public function listAction(Request $request){
        $books = $this-&gt;getRepository(&quot;Books&quot;)-&gt;findAll();
        return $this-&gt;render(
            &#39;Books:list.html.twig&#39;,
            [
                &quot;books&quot; =&gt; $books
            ]
        );
    }
    
    /*
     * @Route(&quot;/books/{id}&quot;,name=&quot;book_view&quot;)
     */
    public function viewAction(Request $request){
        $id = $request-&gt;getParam(&#39;id&#39;) ;
        $book = $this-&gt;getRepository(&quot;Books&quot;)-&gt;find($id);
        return $this-&gt;render(
            &#39;Books:view.html.twig&#39;,
            [
                &quot;book&quot; =&gt; $book
            ]
        );
    }
    
}
</code></pre>
<ul>
<li><code>views/Books/list.html.twig</code> : Exemple de vue</li>
</ul>
<pre><code class="language-twig">&lt;ul&gt;
{% for book in books %}
    &lt;li&gt;    
        &lt;a href=&quot;{{ path(&#39;book_view&#39;,{id: book.id}) }}&quot;&gt;
            {{ book.name }}
        &lt;/a&gt;
    &lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</code></pre>
<p>Remarques :</p>
<ul>
<li>On soulignera l&#39;utilisation du mécanisme de routage pour générer des URL</li>
<li>On utilise ici un moteur de template (<a href="http://twig.sensiolabs.org/doc/tags/for.html" target="_blank">TWIG</a>). Java dispose d&#39;outils analogues (JSP)</li>
<li>On soulignera l&#39;utilisation d&#39;un ORM (Doctrine) pour accéder aux données <code>$this-&gt;getRepository(&quot;Books&quot;)-&gt;findAll()</code>.</li>
</ul>
<h3 id="variantes-côté-serveur">Variantes côté serveur</h3><p>Il existe de nombreux frameworks implémentant des variantes de ce concept :</p>
<ul>
<li><a href="https://spring.io/guides/gs/serving-web-content/#initial" target="_blank">Spring (JAVA)</a></li>
<li><a href="http://expressjs.com/en/starter/hello-world.html" target="_blank">Express (NodeJS)</a></li>
<li><a href="http://symfony.com/doc/current/index.html" target="_blank">Symfony (PHP)</a>, <a href="https://codeigniter.com/userguide3/tutorial/index.html" target="_blank">CodeIgniter</a></li>
</ul>
<h3 id="variantes-côté-navigateur">Variantes côté navigateur</h3><p>Une des tendance actuelle consiste à mettre en place des API REST renvoyant des
données en JSON. La génération du code HTML est effectuée dans le navigateur
en JavaScript.</p>
<p>Côté client, on retrouvera des variantes du concept avec toujours l&#39;idée de séparer le rendu de la manipulation des données :</p>
<ul>
<li><a href="https://reactjs.org/tutorial/tutorial.html#what-is-react" target="_blank">React</a></li>
<li><a href="https://angular.io/tutorial" target="_blank">Angular</a></li>
<li><a href="https://vuejs.org/v2/guide/#Declarative-Rendering" target="_blank">Vue.js</a></li>
</ul>
<h3 id="avantages-de-lutilisation-du-mvc">Avantages de l&#39;utilisation du MVC</h3><ul>
<li>Plus simple à maintenir (on retrouve facilement les actions et vues correspondant aux pages)</li>
<li>Plus simple à sécuriser (cadre pour le contrôle des paramètres)</li>
<li>Débride la croissance de l&#39;application</li>
<li>Travail en équipe facilité (travaille en parallèle sur plusieurs contrôleurs)</li>
<li>Meilleure séparation des rôles (développeurs backend/frontend)</li>
</ul>
<h2 id="ressources">Ressources</h2><ul>
<li><a href="https://spring.io/guides/gs/spring-boot/" target="_blank">spring.io - Building an Application with Spring Boot</a></li>
<li><a href="http://symfony.com/doc/current/book/from_flat_php_to_symfony2.html" target="_blank">Symfony versus Flat PHP</a></li>
</ul>

  </article>

  <!-- hightlight.pack.js -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</body>

</html>
